<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pollinations Image Generator Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Hide scrollbar */
        textarea::-webkit-scrollbar,
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        textarea,
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .image-preview {
            cursor: pointer;
            transition: transform 0.2s;
        }
        .image-preview:hover {
            transform: scale(1.05);
        }

        .loading {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .image-container:hover .action-buttons {
            opacity: 1;
        }

        .action-buttons {
            opacity: 0;
            transition: opacity 0.2s;
        }

        .url-preview-img {
            max-width: 200px;
            max-height: 200px;
            object-fit: contain;
            border-radius: 8px;
            border: 2px solid #3b82f6;
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {},
            },
        }
    </script>
</head>
<body class="bg-white dark:bg-[#131314] text-gray-900 dark:text-gray-100">
    <div class="flex h-screen">
        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col p-6">
            <!-- Header with Title and Stats -->
            <div class="mb-4 flex justify-between items-center">
                <h1 class="text-2xl font-bold">Pollinations AI Generator</h1>
                <div class="text-sm text-gray-500">
                    <span id="imageCount">0</span> gambar dibuat
                </div>
            </div>

            <!-- Generated Images Grid -->
            <div id="imageGrid" class="flex-1 grid grid-cols-2 gap-4 mb-6 overflow-y-auto hide-scrollbar">
                <!-- Images will be displayed here -->
            </div>

            <!-- Prompt Input Area -->
            <div class="border border-gray-300 dark:border-gray-700 rounded-lg p-4">
                <!-- Main Prompt -->
                <textarea 
                    id="promptInput" 
                    placeholder="Masukkan prompt Anda di sini... (contoh: A beautiful sunset over mountains)"
                    class="w-full bg-transparent border-none outline-none resize-none mb-2"
                    rows="2"
                ></textarea>

                <!-- Negative Prompt -->
                <textarea 
                    id="negativePrompt" 
                    placeholder="Negative prompt (opsional): hal yang tidak ingin muncul..."
                    class="w-full bg-transparent border-none outline-none resize-none text-sm text-gray-500"
                    rows="1"
                ></textarea>

                <!-- Image Upload Area for Image-to-Image -->
                <div class="mt-3 mb-3 flex items-center gap-3">
                    <label class="flex items-center gap-2 cursor-pointer px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        <span id="uploadLabel">Upload Gambar</span>
                        <input type="file" id="imageUpload" accept="image/*" class="hidden" />
                    </label>
                    <input 
                        type="text" 
                        id="imageUrl" 
                        placeholder="Atau paste URL gambar di sini..."
                        class="flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg outline-none"
                    />
                </div>

                <!-- URL Preview -->
                <div id="urlPreviewContainer" class="hidden mb-3 p-2 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center gap-3">
                    <img id="urlPreviewImg" class="url-preview-img" />
                    <button onclick="clearUrlPreview()" class="px-3 py-1 bg-red-500 text-white rounded-lg text-sm hover:bg-red-600">
                        Hapus
                    </button>
                </div>

                <div class="flex justify-between items-center">
                    <div class="flex gap-2">
                        <div id="imagePreview" class="text-sm text-gray-500"></div>
                        <button 
                            id="historyBtn"
                            onclick="toggleHistory()"
                            class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm hover:bg-gray-300 dark:hover:bg-gray-600"
                        >
                            📜 History
                        </button>
                    </div>
                    <div class="flex gap-2">
                        <input 
                            type="number" 
                            id="batchCount" 
                            value="1"
                            min="1"
                            max="4"
                            class="w-16 px-2 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg outline-none text-center"
                            title="Jumlah gambar yang akan di-generate"
                        />
                        <button 
                            id="generateBtn"
                            class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium"
                        >
                            Generate
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Sidebar - Settings -->
        <div class="w-80 border-l border-gray-300 dark:border-gray-700 p-6 overflow-y-auto hide-scrollbar">
            <h2 class="text-xl font-bold mb-6">Pengaturan</h2>

            <!-- API Token -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">API Token (Opsional)</label>
                <input 
                    type="password" 
                    id="apiToken" 
                    placeholder="Token untuk model premium"
                    class="w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg outline-none text-sm"
                />
                <p class="text-xs text-gray-500 mt-1">Untuk model Kontext</p>
            </div>

            <!-- Model Selection -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">Model</label>
                <select 
                    id="modelSelect"
                    class="w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg outline-none"
                >
                    <option value="flux">Flux (Free)</option>
                    <option value="turbo">Turbo (Free)</option>
                    <option value="flux-realism">Flux Realism (Free)</option>
                    <option value="flux-anime">Flux Anime (Free)</option>
                    <option value="flux-3d">Flux 3D (Free)</option>
                    <option value="any-dark">Any Dark (Free)</option>
                    <option value="kontext">Kontext (Premium - Image2Image)</option>
                </select>
            </div>

            <!-- Aspect Ratio Presets -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">Aspect Ratio</label>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="setAspectRatio(1024, 1024)" class="px-3 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-xs hover:bg-gray-300 dark:hover:bg-gray-600">1:1</button>
                    <button onclick="setAspectRatio(1280, 720)" class="px-3 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-xs hover:bg-gray-300 dark:hover:bg-gray-600">16:9</button>
                    <button onclick="setAspectRatio(720, 1280)" class="px-3 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-xs hover:bg-gray-300 dark:hover:bg-gray-600">9:16</button>
                    <button onclick="setAspectRatio(1024, 768)" class="px-3 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-xs hover:bg-gray-300 dark:hover:bg-gray-600">4:3</button>
                    <button onclick="setAspectRatio(768, 1024)" class="px-3 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-xs hover:bg-gray-300 dark:hover:bg-gray-600">3:4</button>
                    <button onclick="setAspectRatio(1920, 1080)" class="px-3 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-xs hover:bg-gray-300 dark:hover:bg-gray-600">Full HD</button>
                </div>
            </div>

            <!-- Width -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">Lebar (Width)</label>
                <input 
                    type="number" 
                    id="widthInput" 
                    value="1024"
                    min="256"
                    max="2048"
                    step="64"
                    class="w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg outline-none"
                />
            </div>

            <!-- Height -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">Tinggi (Height)</label>
                <input 
                    type="number" 
                    id="heightInput" 
                    value="1024"
                    min="256"
                    max="2048"
                    step="64"
                    class="w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg outline-none"
                />
            </div>

            <!-- Seed -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">Seed</label>
                <div class="flex gap-2">
                    <input 
                        type="number" 
                        id="seedInput" 
                        placeholder="Random"
                        class="flex-1 px-3 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg outline-none"
                    />
                    <button onclick="randomSeed()" class="px-3 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600">🎲</button>
                </div>
            </div>

            <!-- Options -->
            <div class="space-y-3">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="enhanceCheck" class="w-4 h-4" />
                    <span class="text-sm">Enhance Prompt</span>
                </label>

                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="nologoCheck" checked class="w-4 h-4" />
                    <span class="text-sm">Tanpa Logo</span>
                </label>

                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="privateCheck" class="w-4 h-4" />
                    <span class="text-sm">Private</span>
                </label>

                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="safeCheck" class="w-4 h-4" />
                    <span class="text-sm">Safe Mode</span>
                </label>
            </div>

            <!-- Theme Toggle -->
            <div class="mt-8 pt-6 border-t border-gray-300 dark:border-gray-700">
                <button 
                    id="themeToggle"
                    class="w-full px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600"
                >
                    🌙 Toggle Dark Mode
                </button>
            </div>

            <!-- Clear All -->
            <div class="mt-3">
                <button 
                    onclick="clearAllImages()"
                    class="w-full px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600"
                >
                    🗑️ Clear All Images
                </button>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onclick="closeModal()">
        <div class="max-w-5xl max-h-screen p-4 relative">
            <img id="modalImage" class="max-w-full max-h-full object-contain rounded-lg" />
            <div class="absolute top-6 right-6 flex gap-2">
                <button onclick="downloadModalImage(event)" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    💾 Download
                </button>
                <button onclick="closeModal()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                    ✕ Close
                </button>
            </div>
            <div id="modalPrompt" class="absolute bottom-6 left-6 right-6 bg-black bg-opacity-75 text-white p-4 rounded-lg"></div>
        </div>
    </div>

    <!-- History Sidebar -->
    <div id="historySidebar" class="hidden fixed top-0 right-0 w-80 h-screen bg-white dark:bg-[#131314] border-l border-gray-300 dark:border-gray-700 z-40 shadow-2xl">
        <div class="p-6 h-full flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">📜 History</h2>
                <button onclick="toggleHistory()" class="text-2xl">&times;</button>
            </div>
            <div id="historyList" class="flex-1 overflow-y-auto space-y-2">
                <!-- History items will be added here -->
            </div>
            <button onclick="clearHistory()" class="mt-4 w-full px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                Clear History
            </button>
        </div>
    </div>

    <script>
        let uploadedImage = null;
        let imageCount = 0;
        let promptHistory = JSON.parse(localStorage.getItem('promptHistory')) || [];
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];

        // Initialize
        updateImageCount();

        // Theme Toggle
        document.getElementById('themeToggle').addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
        });

        // Initialize theme
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }

        // Image Upload Handler
        document.getElementById('imageUpload').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    uploadedImage = event.target.result;
                    document.getElementById('uploadLabel').textContent = file.name;
                    document.getElementById('imagePreview').innerHTML = 
                        `<span class="text-green-600">✓ ${file.name}</span>`;
                };
                reader.readAsDataURL(file);
            }
        });

        // URL Input Handler with Preview
        document.getElementById('imageUrl').addEventListener('input', (e) => {
            const url = e.target.value.trim();
            if (url && (url.startsWith('http://') || url.startsWith('https://'))) {
                showUrlPreview(url);
            } else {
                hideUrlPreview();
            }
        });

        function showUrlPreview(url) {
            const container = document.getElementById('urlPreviewContainer');
            const img = document.getElementById('urlPreviewImg');
            img.src = url;
            img.onerror = () => {
                hideUrlPreview();
                alert('URL gambar tidak valid atau tidak bisa diakses');
            };
            img.onload = () => {
                container.classList.remove('hidden');
            };
        }

        function hideUrlPreview() {
            document.getElementById('urlPreviewContainer').classList.add('hidden');
        }

        function clearUrlPreview() {
            document.getElementById('imageUrl').value = '';
            hideUrlPreview();
        }

        // Generate Button Handler
        document.getElementById('generateBtn').addEventListener('click', async () => {
            const prompt = document.getElementById('promptInput').value.trim();
            const negativePrompt = document.getElementById('negativePrompt').value.trim();
            const model = document.getElementById('modelSelect').value;
            const width = document.getElementById('widthInput').value;
            const height = document.getElementById('heightInput').value;
            const seed = document.getElementById('seedInput').value;
            const enhance = document.getElementById('enhanceCheck').checked;
            const nologo = document.getElementById('nologoCheck').checked;
            const privateMode = document.getElementById('privateCheck').checked;
            const safe = document.getElementById('safeCheck').checked;
            const apiToken = document.getElementById('apiToken').value.trim();
            const imageUrl = document.getElementById('imageUrl').value.trim();
            const batchCount = parseInt(document.getElementById('batchCount').value) || 1;

            if (!prompt) {
                alert('Silakan masukkan prompt terlebih dahulu!');
                return;
            }

            // Save to history
            addToHistory(prompt);

            // Show loading
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.innerHTML = '<div class="loading mx-auto"></div>';

            try {
                let imageSource = uploadedImage || imageUrl;

                // Generate multiple images
                for (let i = 0; i < batchCount; i++) {
                    let url;
                    let fullPrompt = prompt;

                    if (negativePrompt) {
                        fullPrompt += ` [negative: ${negativePrompt}]`;
                    }

                    if (model === 'kontext' && imageSource) {
                        if (!apiToken) {
                            alert('Model Kontext memerlukan API Token. Dapatkan di https://auth.pollinations.ai');
                            throw new Error('API Token required');
                        }

                        url = `https://image.pollinations.ai/prompt/${encodeURIComponent(fullPrompt)}`;
                        url += `?model=${model}`;
                        url += `&width=${width}&height=${height}`;
                        if (seed) url += `&seed=${parseInt(seed) + i}`;
                        if (enhance) url += `&enhance=true`;
                        if (nologo) url += `&nologo=true`;
                        if (privateMode) url += `&private=true`;
                        if (safe) url += `&safe=true`;

                    } else {
                        url = `https://image.pollinations.ai/prompt/${encodeURIComponent(fullPrompt)}`;
                        url += `?model=${model}`;
                        url += `&width=${width}&height=${height}`;
                        if (seed) url += `&seed=${parseInt(seed) + i}`;
                        if (enhance) url += `&enhance=true`;
                        if (nologo) url += `&nologo=true`;
                        if (privateMode) url += `&private=true`;
                        if (safe) url += `&safe=true`;
                    }

                    addImageToGrid(url, prompt);

                    // Small delay between batch generations
                    if (i < batchCount - 1) {
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }

                // Clear inputs
                document.getElementById('promptInput').value = '';
                document.getElementById('negativePrompt').value = '';
                uploadedImage = null;
                document.getElementById('imageUpload').value = '';
                document.getElementById('imageUrl').value = '';
                document.getElementById('uploadLabel').textContent = 'Upload Gambar';
                document.getElementById('imagePreview').innerHTML = '';
                hideUrlPreview();

            } catch (error) {
                console.error('Error:', error);
                alert('Terjadi kesalahan saat generate gambar. Silakan coba lagi.');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Generate';
            }
        });

        function addImageToGrid(imageUrl, prompt) {
            const grid = document.getElementById('imageGrid');
            const imageContainer = document.createElement('div');
            imageContainer.className = 'relative aspect-square bg-gray-200 dark:bg-gray-800 rounded-lg overflow-hidden image-container';

            const img = document.createElement('img');
            img.src = imageUrl;
            img.alt = prompt;
            img.className = 'w-full h-full object-cover image-preview';
            img.onclick = () => openModal(imageUrl, prompt);

            const promptOverlay = document.createElement('div');
            promptOverlay.className = 'absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white p-2 text-sm';
            promptOverlay.textContent = prompt.substring(0, 50) + (prompt.length > 50 ? '...' : '');

            // Action buttons
            const actionButtons = document.createElement('div');
            actionButtons.className = 'absolute top-2 right-2 flex gap-2 action-buttons';
            actionButtons.innerHTML = `
                <button onclick="downloadImage(event, '${imageUrl}', '${prompt.replace(/'/g, "\\'")}')" class="px-2 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700">💾</button>
                <button onclick="copyPrompt(event, '${prompt.replace(/'/g, "\\'")}')" class="px-2 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">📋</button>
                <button onclick="toggleFavorite(event, '${imageUrl}', '${prompt.replace(/'/g, "\\'")}')" class="px-2 py-1 bg-yellow-600 text-white rounded text-xs hover:bg-yellow-700">⭐</button>
            `;

            imageContainer.appendChild(img);
            imageContainer.appendChild(promptOverlay);
            imageContainer.appendChild(actionButtons);
            grid.insertBefore(imageContainer, grid.firstChild);

            imageCount++;
            updateImageCount();
        }

        function openModal(imageUrl, prompt) {
            document.getElementById('modalImage').src = imageUrl;
            document.getElementById('modalPrompt').textContent = prompt;
            document.getElementById('imageModal').classList.remove('hidden');
            document.getElementById('imageModal').dataset.currentUrl = imageUrl;
            document.getElementById('imageModal').dataset.currentPrompt = prompt;
        }

        function closeModal() {
            document.getElementById('imageModal').classList.add('hidden');
        }

        function downloadImage(event, url, prompt) {
            event.stopPropagation();
            const link = document.createElement('a');
            link.href = url;
            link.download = `pollinations-${Date.now()}.png`;
            link.click();
        }

        function downloadModalImage(event) {
            event.stopPropagation();
            const url = document.getElementById('imageModal').dataset.currentUrl;
            const prompt = document.getElementById('imageModal').dataset.currentPrompt;
            downloadImage(event, url, prompt);
        }

        function copyPrompt(event, prompt) {
            event.stopPropagation();
            navigator.clipboard.writeText(prompt);
            alert('Prompt disalin ke clipboard!');
        }

        function toggleFavorite(event, url, prompt) {
            event.stopPropagation();
            // Implementation for favorites
            alert('Fitur favorite - Coming soon!');
        }

        function updateImageCount() {
            document.getElementById('imageCount').textContent = imageCount;
        }

        function clearAllImages() {
            if (confirm('Hapus semua gambar? Tindakan ini tidak dapat dibatalkan.')) {
                document.getElementById('imageGrid').innerHTML = '';
                imageCount = 0;
                updateImageCount();
            }
        }

        // Aspect Ratio Functions
        function setAspectRatio(width, height) {
            document.getElementById('widthInput').value = width;
            document.getElementById('heightInput').value = height;
        }

        function randomSeed() {
            document.getElementById('seedInput').value = Math.floor(Math.random() * 1000000);
        }

        // History Functions
        function addToHistory(prompt) {
            if (prompt && !promptHistory.includes(prompt)) {
                promptHistory.unshift(prompt);
                if (promptHistory.length > 20) promptHistory.pop();
                localStorage.setItem('promptHistory', JSON.stringify(promptHistory));
                updateHistoryList();
            }
        }

        function updateHistoryList() {
            const list = document.getElementById('historyList');
            list.innerHTML = '';
            promptHistory.forEach((prompt, index) => {
                const item = document.createElement('div');
                item.className = 'p-3 bg-gray-100 dark:bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700';
                item.textContent = prompt.substring(0, 60) + (prompt.length > 60 ? '...' : '');
                item.onclick = () => {
                    document.getElementById('promptInput').value = prompt;
                    toggleHistory();
                };
                list.appendChild(item);
            });
        }

        function toggleHistory() {
            const sidebar = document.getElementById('historySidebar');
            sidebar.classList.toggle('hidden');
            updateHistoryList();
        }

        function clearHistory() {
            if (confirm('Hapus semua history?')) {
                promptHistory = [];
                localStorage.removeItem('promptHistory');
                updateHistoryList();
            }
        }

        // Allow Enter to generate
        document.getElementById('promptInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                document.getElementById('generateBtn').click();
            }
        });

        // Initialize history
        updateHistoryList();
    </script>
</body>
</html>
