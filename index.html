<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pollinations Image Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Hide scrollbar */
        textarea::-webkit-scrollbar,
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        textarea,
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .image-preview {
            cursor: pointer;
            transition: transform 0.2s;
        }
        .image-preview:hover {
            transform: scale(1.05);
        }
        
        .loading {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {},
            },
        }
    </script>
</head>
<body class="bg-white dark:bg-[#131314] text-gray-900 dark:text-gray-100">
    <div class="flex h-screen">
        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col p-6">
            <!-- Generated Images Grid -->
            <div id="imageGrid" class="flex-1 grid grid-cols-2 gap-4 mb-6 overflow-y-auto hide-scrollbar">
                <!-- Images will be displayed here -->
            </div>
            
            <!-- Prompt Input Area -->
            <div class="border border-gray-300 dark:border-gray-700 rounded-lg p-4">
                <textarea 
                    id="promptInput" 
                    placeholder="Masukkan prompt Anda di sini..."
                    class="w-full bg-transparent border-none outline-none resize-none"
                    rows="3"
                ></textarea>
                
                <!-- Image Upload Area for Image-to-Image -->
                <div class="mt-3 mb-3 flex items-center gap-3">
                    <label class="flex items-center gap-2 cursor-pointer px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        <span id="uploadLabel">Upload Gambar (Opsional)</span>
                        <input type="file" id="imageUpload" accept="image/*" class="hidden" />
                    </label>
                    <input 
                        type="text" 
                        id="imageUrl" 
                        placeholder="Atau masukkan URL gambar..."
                        class="flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg outline-none"
                    />
                </div>
                
                <div class="flex justify-between items-center">
                    <div id="imagePreview" class="text-sm text-gray-500"></div>
                    <button 
                        id="generateBtn"
                        class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium"
                    >
                        Generate
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Right Sidebar - Settings -->
        <div class="w-80 border-l border-gray-300 dark:border-gray-700 p-6 overflow-y-auto hide-scrollbar">
            <h2 class="text-xl font-bold mb-6">Pengaturan</h2>
            
            <!-- API Token (untuk model premium) -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">API Token (Opsional)</label>
                <input 
                    type="password" 
                    id="apiToken" 
                    placeholder="Token untuk model premium"
                    class="w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg outline-none text-sm"
                />
                <p class="text-xs text-gray-500 mt-1">Diperlukan untuk model Kontext</p>
            </div>
            
            <!-- Model Selection -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">Model</label>
                <select 
                    id="modelSelect"
                    class="w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg outline-none"
                >
                    <option value="flux">Flux (Free)</option>
                    <option value="turbo">Turbo (Free)</option>
                    <option value="flux-realism">Flux Realism (Free)</option>
                    <option value="flux-anime">Flux Anime (Free)</option>
                    <option value="kontext">Kontext (Premium - Image2Image)</option>
                </select>
            </div>
            
            <!-- Width -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">Lebar (Width)</label>
                <input 
                    type="number" 
                    id="widthInput" 
                    value="1024"
                    min="256"
                    max="2048"
                    step="64"
                    class="w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg outline-none"
                />
            </div>
            
            <!-- Height -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">Tinggi (Height)</label>
                <input 
                    type="number" 
                    id="heightInput" 
                    value="1024"
                    min="256"
                    max="2048"
                    step="64"
                    class="w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg outline-none"
                />
            </div>
            
            <!-- Seed -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">Seed</label>
                <input 
                    type="number" 
                    id="seedInput" 
                    placeholder="Random (kosongkan)"
                    class="w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg outline-none"
                />
            </div>
            
            <!-- Options -->
            <div class="space-y-3">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="enhanceCheck" class="w-4 h-4" />
                    <span class="text-sm">Enhance Prompt</span>
                </label>
                
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="nologoCheck" checked class="w-4 h-4" />
                    <span class="text-sm">Tanpa Logo</span>
                </label>
                
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="privateCheck" class="w-4 h-4" />
                    <span class="text-sm">Private</span>
                </label>
                
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="safeCheck" class="w-4 h-4" />
                    <span class="text-sm">Safe Mode</span>
                </label>
            </div>
            
            <!-- Theme Toggle -->
            <div class="mt-8 pt-6 border-t border-gray-300 dark:border-gray-700">
                <button 
                    id="themeToggle"
                    class="w-full px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600"
                >
                    Toggle Dark Mode
                </button>
            </div>
        </div>
    </div>
    
    <!-- Image Modal -->
    <div id="imageModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onclick="closeModal()">
        <div class="max-w-4xl max-h-screen p-4">
            <img id="modalImage" class="max-w-full max-h-full object-contain rounded-lg" />
        </div>
    </div>
    
    <script>
        let uploadedImage = null;
        
        // Theme Toggle
        document.getElementById('themeToggle').addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
        });
        
        // Initialize theme
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }
        
        // Image Upload Handler
        document.getElementById('imageUpload').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    uploadedImage = event.target.result;
                    document.getElementById('uploadLabel').textContent = file.name;
                    document.getElementById('imagePreview').innerHTML = 
                        `<span class="text-green-600">✓ Gambar terupload: ${file.name}</span>`;
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Generate Button Handler
        document.getElementById('generateBtn').addEventListener('click', async () => {
            const prompt = document.getElementById('promptInput').value.trim();
            const model = document.getElementById('modelSelect').value;
            const width = document.getElementById('widthInput').value;
            const height = document.getElementById('heightInput').value;
            const seed = document.getElementById('seedInput').value;
            const enhance = document.getElementById('enhanceCheck').checked;
            const nologo = document.getElementById('nologoCheck').checked;
            const privateMode = document.getElementById('privateCheck').checked;
            const safe = document.getElementById('safeCheck').checked;
            const apiToken = document.getElementById('apiToken').value.trim();
            const imageUrl = document.getElementById('imageUrl').value.trim();
            
            if (!prompt) {
                alert('Silakan masukkan prompt terlebih dahulu!');
                return;
            }
            
            // Show loading
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.innerHTML = '<div class="loading mx-auto"></div>';
            
            try {
                let imageSource = uploadedImage || imageUrl;
                
                // Build URL based on model and image source
                let url;
                
                if (model === 'kontext' && imageSource) {
                    // Image-to-Image with Kontext model (Premium)
                    if (!apiToken) {
                        alert('Model Kontext memerlukan API Token. Dapatkan di https://auth.pollinations.ai');
                        throw new Error('API Token required for Kontext model');
                    }
                    
                    // For Kontext, we need to use the premium API endpoint
                    // Note: This is a simplified version. In production, you'd need to handle
                    // image upload to the Pollinations service first
                    url = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}`;
                    url += `?model=${model}`;
                    url += `&width=${width}&height=${height}`;
                    if (seed) url += `&seed=${seed}`;
                    if (enhance) url += `&enhance=true`;
                    if (nologo) url += `&nologo=true`;
                    if (privateMode) url += `&private=true`;
                    if (safe) url += `&safe=true`;
                    
                    // Add authentication header (note: this needs to be handled server-side in production)
                    console.log('Note: API Token authentication should be handled server-side');
                    
                } else {
                    // Standard text-to-image generation
                    url = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}`;
                    url += `?model=${model}`;
                    url += `&width=${width}&height=${height}`;
                    if (seed) url += `&seed=${seed}`;
                    if (enhance) url += `&enhance=true`;
                    if (nologo) url += `&nologo=true`;
                    if (privateMode) url += `&private=true`;
                    if (safe) url += `&safe=true`;
                }
                
                // Add generated image to grid
                addImageToGrid(url, prompt);
                
                // Clear inputs
                document.getElementById('promptInput').value = '';
                uploadedImage = null;
                document.getElementById('imageUpload').value = '';
                document.getElementById('imageUrl').value = '';
                document.getElementById('uploadLabel').textContent = 'Upload Gambar (Opsional)';
                document.getElementById('imagePreview').innerHTML = '';
                
            } catch (error) {
                console.error('Error:', error);
                alert('Terjadi kesalahan saat generate gambar. Silakan coba lagi.');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Generate';
            }
        });
        
        function addImageToGrid(imageUrl, prompt) {
            const grid = document.getElementById('imageGrid');
            const imageContainer = document.createElement('div');
            imageContainer.className = 'relative aspect-square bg-gray-200 dark:bg-gray-800 rounded-lg overflow-hidden';
            
            const img = document.createElement('img');
            img.src = imageUrl;
            img.alt = prompt;
            img.className = 'w-full h-full object-cover image-preview';
            img.onclick = () => openModal(imageUrl);
            
            const promptOverlay = document.createElement('div');
            promptOverlay.className = 'absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white p-2 text-sm';
            promptOverlay.textContent = prompt.substring(0, 50) + (prompt.length > 50 ? '...' : '');
            
            imageContainer.appendChild(img);
            imageContainer.appendChild(promptOverlay);
            grid.insertBefore(imageContainer, grid.firstChild);
        }
        
        function openModal(imageUrl) {
            document.getElementById('modalImage').src = imageUrl;
            document.getElementById('imageModal').classList.remove('hidden');
        }
        
        function closeModal() {
            document.getElementById('imageModal').classList.add('hidden');
        }
        
        // Allow Enter to generate (Shift+Enter for new line)
        document.getElementById('promptInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                document.getElementById('generateBtn').click();
            }
        });
    </script>
</body>
</html>
